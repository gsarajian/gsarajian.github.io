<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>RecFlix: Linear Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
    .navigation ul {
  list-style-type: none;
  text-align: left;
  padding-left: 0;
  padding-bottom: 2em;
}

.navigation li {
  display: inline;
}

.navigation a {
    color: #3366FF;
    text-decoration: none;
}

</style>


<script src="RecFlix Linear Model_files/libs/clipboard/clipboard.min.js"></script>
<script src="RecFlix Linear Model_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="RecFlix Linear Model_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="RecFlix Linear Model_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="RecFlix Linear Model_files/libs/quarto-html/popper.min.js"></script>
<script src="RecFlix Linear Model_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="RecFlix Linear Model_files/libs/quarto-html/anchor.min.js"></script>
<link href="RecFlix Linear Model_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="RecFlix Linear Model_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="RecFlix Linear Model_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="RecFlix Linear Model_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="RecFlix Linear Model_files/libs/bootstrap/bootstrap-9e3ffae467580fdb927a41352e75a2e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">RecFlix: Linear Model</h1>
</div>
        <div class="navigation">
            <ul>
                <li><a href="https://gsarajian.github.io">Home</a></li> //
                <li><a href="https://gsarajian.github.io/projects">Projects</a></li>  //
                <li><a href="https://gsarajian.github.io/research">Research</a></li>  
            </ul>
        </div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="motivation" class="level3">
<h3 class="anchored" data-anchor-id="motivation">Motivation</h3>
<!-- ![Alt text](https://doimages.nyc3.cdn.digitaloceanspaces.com/002Blog/0-BLOG-BANNERS/app_platform.png "a title") -->
<!-- ![Perfect average rating with low count or high average rating with high count](amz_rats.png "mem") -->
<!-- ![Perfect average rating with low count or high average rating with high count](amz_rats.png) -->
<!-- ![](Screenshots/amz_rats.png) -->
<p><img src="Media/Cultural ratings.jpg" width="1000" height="500"></p>
<p>This is the third installment of a <a href="https://gsarajian.github.io/RecFlix/Overview">sequence</a> on <a href="https://en.wikipedia.org/wiki/Recommender_system">recommendation systems</a>.</p>
<section id="how-do-we-account-for-raters-biases" class="level4">
<h4 class="anchored" data-anchor-id="how-do-we-account-for-raters-biases">How do we account for raters’ biases?</h4>
<p>Say we want to take user ratings of movies and rank them. Some previous approaches try to rank movies by accounting for sample sizes and confidence intervals, but they didn’t consider <em>biases of users who were doing the ratings</em>. Indeed, if User A just happens to indiscriminantly love movies and rate them all highly, and also happens to be the only person who rated Movie 1, then that movie might currently be overrated. We can apply a linear model to account for raters’ biases to uncover what a movie’s rating would be after adjusting for its raters. This is an example of a non-personalzed recommendation system. Let’s start by looking at the highest rated movies from the <a href="https://www.kaggle.com/datasets/jneupane12/movielens">MovieLens dataset on Kaggle</a>.</p>
<div id="5aad938b" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import the data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ratings doesn't include movie names so merge with ids to get names</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> pd.read_csv(<span class="st">"archive/rating.csv"</span>, parse_dates<span class="op">=</span>[<span class="st">'timestamp'</span>])</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>ids <span class="op">=</span> pd.read_csv(<span class="st">"archive/movie.csv"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> pd.merge(ratings, ids, on<span class="op">=</span><span class="st">'movieId'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Find each movie's mean rating</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>avg_ratings <span class="op">=</span> ratings.groupby([<span class="st">'movieId'</span>, <span class="st">'title'</span>])[<span class="st">'rating'</span>].agg(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    avg_rating<span class="op">=</span><span class="st">'mean'</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    rating_count<span class="op">=</span><span class="st">'count'</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>avg_ratings.sort_values(by <span class="op">=</span> <span class="st">'avg_rating'</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>avg_ratings.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
movieId
</th>
<th>
Title
</th>
<th>
Mean Rating
</th>
<th>
Number of Ratings
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
117314
</td>
<td>
Neurons to Nirvana (2013)
</td>
<td>
5.0
</td>
<td>
1
</td>
</tr>
<tr>
<td>
117418
</td>
<td>
Victor and the Secret of Crocodile Mansion (2012)
</td>
<td>
5.0
</td>
<td>
1
</td>
</tr>
<tr>
<td>
117061
</td>
<td>
The Green (2011)
</td>
<td>
5.0
</td>
<td>
1
</td>
</tr>
<tr>
<td>
109571
</td>
<td>
Into the Middle of Nowhere (2010)
</td>
<td>
5.0
</td>
<td>
1
</td>
</tr>
<tr>
<td>
109715
</td>
<td>
Inquire Within (2012)
</td>
<td>
5.0
</td>
<td>
1
</td>
</tr>
</tbody>
</table>
<p>After accounting for who the raters of these films were, we’ll have a better idea of what they might be rated. There are a lot of approaches we can take with the linear model, such as filtering to only include movies with a certain number of ratings.</p>
<p>We can define our variables as</p>
<ul>
<li><span class="math inline">\(r_{ij}\)</span> is the rating that person <span class="math inline">\(i\)</span> gave (or would give) movie <span class="math inline">\(j\)</span></li>
</ul>
<p>Our statistical model is then</p>
<p><span class="math display">\[r_{ij} = \mu + \alpha_i + \beta_j\]</span></p>
<p>And we can use ordinary least squares to estimate the <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\beta_j\)</span>. Here,</p>
<ul>
<li><span class="math inline">\(\mu\)</span> is the overall (global) mean</li>
<li><span class="math inline">\(\alpha_i\)</span> is the “effect” of user <span class="math inline">\(i\)</span>, which measures how much above the mean user <span class="math inline">\(i\)</span> tends to rate movies after considering movie effects, and</li>
<li><span class="math inline">\(\beta_j\)</span> is the “effect” of movie <span class="math inline">\(j\)</span>, which measures how much above the mean movie <span class="math inline">\(j\)</span> tends to score, after considering user effects.</li>
</ul>
<p>Once the model is fit, we can look at <span class="math inline">\(\beta_j\)</span> to determine which movies are scoring the highest <em>after accounting for the users</em>.</p>
<p>Mathematically, we’re finding the optimal parameters <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\beta_j\)</span> that minimize the <a href="https://en.wikipedia.org/wiki/Mean_squared_error">mean squared error</a> plus a <a href="https://en.wikipedia.org/wiki/Regularization_(mathematics)">regularization</a> term:</p>
<p><span class="math display">\[L(\vec{\alpha}, \vec{\beta}) = \sum_{i, j} \left (r_{ij} - (\mu + \alpha_i + \beta_j) \right )^2 + \lambda \left ( \sum_i \alpha_i^2 + \sum_j \beta_j^2 \right ) \]</span></p>
<p>The regularization here is an <span class="math inline">\(L^2\)</span> or <a href="https://en.wikipedia.org/wiki/Ridge_regression">ridge regression</a>, and alternatively, one could incorporate <a href="https://en.wikipedia.org/wiki/Lasso_(statistics)">LASSO regularization</a>. The hyperparameter <span class="math inline">\(\lambda\)</span> can be fine tuned, which we’ll discuss in another post; here it’s taken to be <span class="math inline">\(\lambda = 1\)</span>.</p>
<div id="ecd74f85-a5a2-4211-bd30-a9a99908676e" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># setup and fit the model</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this cell will likely take a while to run, there &gt; 20,000 parameters to fit in this optimization</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ohe <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>, sparse_output<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_pipeline(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    ohe,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    Ridge(alpha<span class="op">=</span><span class="fl">1.0</span>)       <span class="co"># or Lasso. This is lambda in the equation above</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>model.fit(ratings[[<span class="st">'userId'</span>,<span class="st">'movieId'</span>]], ratings[<span class="st">'rating'</span>])</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> model.named_steps[<span class="st">'onehotencoder'</span>]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> encoder.get_feature_names_out([<span class="st">'userId'</span>, <span class="st">'movieId'</span>])</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>coef <span class="op">=</span> model.named_steps[<span class="st">'ridge'</span>].coef_</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>intercept <span class="op">=</span> model.named_steps[<span class="st">'ridge'</span>].intercept_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="8b059d61-6be3-4c6d-9895-37382ce8fb78" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the coefficients alpha_i and beta_j</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>coef_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'feature'</span>: feature_names,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'coefficient'</span>: coef</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>}).sort_values(by<span class="op">=</span><span class="st">'coefficient'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="ffd9da03-e8da-4a6c-ae88-633ff0b01dc3" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract only the users' coefficients, alpha_i</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>user_df <span class="op">=</span> coef_df[coef_df[<span class="st">'feature'</span>].<span class="bu">str</span>.startswith(<span class="st">'userId'</span>)]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>user_df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="5b0dfff2-af85-4170-bf5a-d06c954e75e1" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract only the movies' coefficients, beta_j</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>movie_df <span class="op">=</span> coef_df[coef_df[<span class="st">'feature'</span>].<span class="bu">str</span>.startswith(<span class="st">'movieId'</span>)]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>movie_df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="d752b393-3183-447d-ae9d-bd2803cdd986" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare the df for merging to get movie names</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>movie_df[<span class="st">'movieId'</span>] <span class="op">=</span> movie_df[<span class="st">'feature'</span>].<span class="bu">str</span>.split(<span class="st">'_'</span>, expand<span class="op">=</span><span class="va">True</span>)[<span class="dv">1</span>].astype(<span class="bu">int</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>movie_df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="f1fef8e8-8161-495d-8e35-25541a7201b6" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge to get movie names</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> movie_df.merge(mean_ratings, on<span class="op">=</span><span class="st">'movieId'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="66541322-0afc-4490-b8bb-e7a156c1db47" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get adjusted ratings by not incorporating any alpha_i, just taking mu + beta_j</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>global_mean <span class="op">=</span> ratings[<span class="st">'rating'</span>].mean()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>merged[<span class="st">'Adjusted Rating'</span>] <span class="op">=</span> global_mean <span class="op">+</span> merged[<span class="st">'coefficient'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="e2f9b4ab-1057-4177-996f-87851d539672" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find which movies have the largest coefficients</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>merged.sort_values(by <span class="op">=</span> <span class="st">'coefficient'</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>merged[[<span class="st">'title'</span>, <span class="st">'coefficient'</span>, <span class="st">'avg_rating'</span>, <span class="st">'rating_count'</span>]].head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Title
</th>
<th>
Adjusted Rating
</th>
<th>
Coefficient
</th>
<th>
Mean Rating
</th>
<th>
Number of Ratings
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
Marihuana (1936)
</td>
<td>
5.547
</td>
<td>
2.021
</td>
<td>
5.000
</td>
<td>
1
</td>
</tr>
<tr>
<th>
1
</th>
<td>
Always for Pleasure (1978)
</td>
<td>
5.070
</td>
<td>
1.544
</td>
<td>
5.000
</td>
<td>
1
</td>
</tr>
<tr>
<th>
2
</th>
<td>
Supermarket Woman (Sûpâ no onna) (1996)
</td>
<td>
4.956
</td>
<td>
1.431
</td>
<td>
4.750
</td>
<td>
2
</td>
</tr>
<tr>
<th>
3
</th>
<td>
Great White Silence, The (1924)
</td>
<td>
4.861
</td>
<td>
1.336
</td>
<td>
4.500
</td>
<td>
4
</td>
</tr>
<tr>
<th>
4
</th>
<td>
Welfare (1975)
</td>
<td>
4.835
</td>
<td>
1.309
</td>
<td>
4.417
</td>
<td>
6
</td>
</tr>
<tr>
<th>
5
</th>
<td>
I Belong (Som du ser meg) (2012)
</td>
<td>
4.815
</td>
<td>
1.289
</td>
<td>
4.750
</td>
<td>
2
</td>
</tr>
<tr>
<th>
6
</th>
<td>
No Distance Left to Run (2010)
</td>
<td>
4.812
</td>
<td>
1.287
</td>
<td>
5.000
</td>
<td>
1
</td>
</tr>
<tr>
<th>
7
</th>
<td>
Hot Pepper (1973)
</td>
<td>
4.808
</td>
<td>
1.282
</td>
<td>
4.250
</td>
<td>
2
</td>
</tr>
<tr>
<th>
8
</th>
<td>
For Neda (2010)
</td>
<td>
4.798
</td>
<td>
1.272
</td>
<td>
4.500
</td>
<td>
5
</td>
</tr>
<tr>
<th>
9
</th>
<td>
That Day, on the Beach (Hai tan de yi tian) (1983)
</td>
<td>
4.786
</td>
<td>
1.261
</td>
<td>
4.500
</td>
<td>
2
</td>
</tr>
</tbody>
</table>
<p>It looks like we have the same issue as before, where some movies with very few ratings are still dominating the ratings. If we filter to only include movies with at least 50 ratings, we see a list that closely resembles the top 10 movies if we looked at the mean rating. First, our list of top 10 adjusted ratings:</p>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Title
</th>
<th>
Adjusted Rating
</th>
<th>
Coefficient
</th>
<th>
Mean Rating
</th>
<th>
Number of Ratings
</th>
</tr>

</thead>
<tbody>
<tr>
<th>
45
</th>
<td>
Shawshank Redemption, The (1994)
</td>
<td>
4.609
</td>
<td>
1.083
</td>
<td>
4.447
</td>
<td>
63366
</td>
</tr>
<tr>
<th>
61
</th>
<td>
Godfather, The (1972)
</td>
<td>
4.558
</td>
<td>
1.032
</td>
<td>
4.365
</td>
<td>
41355
</td>
</tr>
<tr>
<th>
69
</th>
<td>
Paths of Glory (1957)
</td>
<td>
4.535
</td>
<td>
1.009
</td>
<td>
4.233
</td>
<td>
3568
</td>
</tr>
<tr>
<th>
79
</th>
<td>
Usual Suspects, The (1995)
</td>
<td>
4.525
</td>
<td>
0.999
</td>
<td>
4.334
</td>
<td>
47006
</td>
</tr>
<tr>
<th>
85
</th>
<td>
Seven Samurai (Shichinin no samurai) (1954)
</td>
<td>
4.520
</td>
<td>
0.994
</td>
<td>
4.274
</td>
<td>
11611
</td>
</tr>
<tr>
<th>
87
</th>
<td>
Sunset Blvd. (a.k.a. Sunset Boulevard) (1950)
</td>
<td>
4.519
</td>
<td>
0.993
</td>
<td>
4.257
</td>
<td>
6525
</td>
</tr>
<tr>
<th>
89
</th>
<td>
Third Man, The (1949)
</td>
<td>
4.518
</td>
<td>
0.992
</td>
<td>
4.246
</td>
<td>
6565
</td>
</tr>
<tr>
<th>
90
</th>
<td>
Decalogue, The (Dekalog) (1989)
</td>
<td>
4.516
</td>
<td>
0.991
</td>
<td>
4.174
</td>
<td>
402
</td>
</tr>
<tr>
<th>
92
</th>
<td>
Lives of Others, The (Das leben der Anderen) (2006)
</td>
<td>
4.514
</td>
<td>
0.989
</td>
<td>
4.235
</td>
<td>
5720
</td>
</tr>
<tr>
<th>
95
</th>
<td>
Fawlty Towers (1975-1979)
</td>
<td>
4.512
</td>
<td>
0.986
</td>
<td>
4.128
</td>
<td>
230
</td>
</tr>
</tbody>
</table>
<p>Now compare this with the list of the top 10 movies with at least 50 reviews, sorted by mean rating:</p>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
movieId
</th>
<th>
Title
</th>
<th>
Mean Rating
</th>
<th>
Number of Ratings
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
318
</td>
<td>
Shawshank Redemption, The (1994)
</td>
<td>
4.447
</td>
<td>
63366
</td>
</tr>
<tr>
<td>
858
</td>
<td>
Godfather, The (1972)
</td>
<td>
4.365
</td>
<td>
41355
</td>
</tr>
<tr>
<td>
50
</td>
<td>
Usual Suspects, The (1995)
</td>
<td>
4.334
</td>
<td>
47006
</td>
</tr>
<tr>
<td>
527
</td>
<td>
Schindler’s List (1993)
</td>
<td>
4.310
</td>
<td>
50054
</td>
</tr>
<tr>
<td>
1221
</td>
<td>
Godfather: Part II, The (1974)
</td>
<td>
4.276
</td>
<td>
27398
</td>
</tr>
<tr>
<td>
2019
</td>
<td>
Seven Samurai (Shichinin no samurai) (1954)
</td>
<td>
4.274
</td>
<td>
11611
</td>
</tr>
<tr>
<td>
904
</td>
<td>
Rear Window (1954)
</td>
<td>
4.271
</td>
<td>
17449
</td>
</tr>
<tr>
<td>
7502
</td>
<td>
Band of Brothers (2001)
</td>
<td>
4.263
</td>
<td>
4305
</td>
</tr>
<tr>
<td>
912
</td>
<td>
Casablanca (1942)
</td>
<td>
4.258
</td>
<td>
24349
</td>
</tr>
<tr>
<td>
922
</td>
<td>
Sunset Blvd. (a.k.a. Sunset Boulevard) (1950)
</td>
<td>
4.257
</td>
<td>
6525
</td>
</tr>
</tbody>
</table>
<p>Half the movies appear on both lists, but then a handful differ. It’s interesting to see some international films rise in the adjusted rankings; I wonder if this is partially due to cultural norms when it comes ratings, which is well-summarized in the meme at the top that I took from <a href="https://www.youtube.com/playlist?list=PLDcUM9US4XdPz-KxHM4XHt7uUVGWWVSus">the lectures</a> from my <a href="https://github.com/erictleung/statistical-rethinking-book-club">Bayesian stats book club</a>. In more words, are those movies/shows being rated by people who tend to assign lower ratings, leading them to be underrated? There are <a href="https://www.reddit.com/r/travel/comments/9c19mt/my_uber_rating_has_tanked_since_i_started_using/">some</a> <a href="https://spendmatters.com/2018/01/19/uber-rating-lousy-can-teach-us-solution-provider-rankings/">anecdotal</a> examples of people experiencing cultural differences in ratings, and others have explored the subject <a href="https://measuringu.com/scales-cultural-effects/">quantitatively</a>, noticing <a href="https://www.nature.com/articles/s41562-024-02003-6">differences across genders</a> as well.</p>
<p>One more thing I’d like to look at is which movies have the largest gaps between their unadjusted and adjusted ratings, i.e.&nbsp;the largest residuals. We can think of these as the most underrated (or overrated) movies, consequences of being rated by many folks who consistently rate much lower (or higher) than the average rater. Let’s start with some underrated ones:</p>
<div id="a96d39f1-5098-48d7-95c5-21cc241a6432" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>merged[<span class="st">'Delta'</span>] <span class="op">=</span> merged[<span class="st">'Adjusted Rating'</span>] <span class="op">-</span> merged[<span class="st">'avg_rating'</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>merged.sort_values(by <span class="op">=</span> <span class="st">'Delta'</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>merged.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Title
</th>
<th>
Average Rating
</th>
<th>
Adjusted Rating
</th>
<th>
Delta
</th>
<th>
Number of Ratings
</th>
<th>
Movie Coefficient
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
23061
</th>
<td>
Alone for Christmas (2013)
</td>
<td>
0.5
</td>
<td>
2.968
</td>
<td>
2.468
</td>
<td>
1
</td>
<td>
-0.557
</td>
</tr>
<tr>
<th>
23062
</th>
<td>
Tom and Jerry: The Lost Dragon (2014)
</td>
<td>
0.5
</td>
<td>
2.968
</td>
<td>
2.468
</td>
<td>
1
</td>
<td>
-0.557
</td>
</tr>
<tr>
<th>
23063
</th>
<td>
Andrew Dice Clay: Indestructible (2012)
</td>
<td>
0.5
</td>
<td>
2.968
</td>
<td>
2.468
</td>
<td>
1
</td>
<td>
-0.557
</td>
</tr>
<tr>
<th>
23238
</th>
<td>
Rimini, Rimini: A Year Later (1988)
</td>
<td>
0.5
</td>
<td>
2.947
</td>
<td>
2.447
</td>
<td>
1
</td>
<td>
-0.579
</td>
</tr>
<tr>
<th>
23272
</th>
<td>
Age of Dinosaurs (2013)
</td>
<td>
0.5
</td>
<td>
2.941
</td>
<td>
2.441
</td>
<td>
1
</td>
<td>
-0.585
</td>
</tr>
<tr>
<th>
23271
</th>
<td>
Captive Women (1000 Years from Now) (3000 A.D.) (1952)
</td>
<td>
0.5
</td>
<td>
2.941
</td>
<td>
2.441
</td>
<td>
1
</td>
<td>
-0.585
</td>
</tr>
<tr>
<th>
23466
</th>
<td>
Beethoven’s 5th (2003)
</td>
<td>
0.5
</td>
<td>
2.918
</td>
<td>
2.418
</td>
<td>
1
</td>
<td>
-0.607
</td>
</tr>
<tr>
<th>
23461
</th>
<td>
Beethoven’s Treasure Tail (2014)
</td>
<td>
0.5
</td>
<td>
2.918
</td>
<td>
2.418
</td>
<td>
1
</td>
<td>
-0.607
</td>
</tr>
<tr>
<th>
23455
</th>
<td>
Alpha and Omega 2: A Howl-iday Adventure (Alpha &amp; Omega 2) (2013)
</td>
<td>
0.5
</td>
<td>
2.918
</td>
<td>
2.418
</td>
<td>
1
</td>
<td>
-0.607
</td>
</tr>
<tr>
<th>
23465
</th>
<td>
Mr.&nbsp;Troop Mom (2009)
</td>
<td>
0.5
</td>
<td>
2.918
</td>
<td>
2.418
</td>
<td>
1
</td>
<td>
-0.607
</td>
</tr>
</tbody>
</table>
<p>Again, movies with only one rating comprise this list. These movies were all rated half of a star by a single user, and their respective movie coefficients (<span class="math inline">\(\beta_j\)</span>) aren’t too large in magnitude, so the difference in ratings is high. Even if we try to do the same analysis with movies with at least 50 ratings, they’re not too recognizable, but I’d guess these are somewhat underrated due to cultural rating norms.</p>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Title
</th>
<th>
Average Rating
</th>
<th>
Adjusted Rating
</th>
<th>
Delta
</th>
<th>
Number of Ratings
</th>
<th>
Movie Coefficient
</th>
</tr>

</thead>
<tbody>
<tr>
<th>
8622
</th>
<td>
As Tears Go By (Wong gok ka moon) (1988)
</td>
<td>
3.192
</td>
<td>
3.806
</td>
<td>
0.614
</td>
<td>
52
</td>
<td>
0.281
</td>
</tr>
<tr>
<th>
4389
</th>
<td>
Merchant of Four Seasons, The (Händler der vier Jahreszeiten) (1972)
</td>
<td>
3.406
</td>
<td>
4.009
</td>
<td>
0.603
</td>
<td>
64
</td>
<td>
0.483
</td>
</tr>
<tr>
<th>
15770
</th>
<td>
Pellet (Bola, El) (2000)
</td>
<td>
2.900
</td>
<td>
3.473
</td>
<td>
0.573
</td>
<td>
50
</td>
<td>
-0.053
</td>
</tr>
<tr>
<th>
11091
</th>
<td>
Separation, The (Séparation, La) (1994)
</td>
<td>
3.127
</td>
<td>
3.690
</td>
<td>
0.563
</td>
<td>
51
</td>
<td>
0.165
</td>
</tr>
<tr>
<th>
1299
</th>
<td>
Autumn Afternoon, An (Sanma no aji) (1962)
</td>
<td>
3.669
</td>
<td>
4.228
</td>
<td>
0.559
</td>
<td>
71
</td>
<td>
0.702
</td>
</tr>
<tr>
<th>
12790
</th>
<td>
See the Sea (1997)
</td>
<td>
3.054
</td>
<td>
3.611
</td>
<td>
0.557
</td>
<td>
56
</td>
<td>
0.086
</td>
</tr>
<tr>
<th>
6203
</th>
<td>
Dames du Bois de Boulogne, Les (Ladies of the Bois de Boulogne, The) (Ladies of the Park) (1945)
</td>
<td>
3.357
</td>
<td>
3.914
</td>
<td>
0.557
</td>
<td>
70
</td>
<td>
0.389
</td>
</tr>
<tr>
<th>
1728
</th>
<td>
Eureka (Yurîka) (2000)
</td>
<td>
3.630
</td>
<td>
4.185
</td>
<td>
0.555
</td>
<td>
96
</td>
<td>
0.660
</td>
</tr>
<tr>
<th>
8676
</th>
<td>
Lili Marleen (1981)
</td>
<td>
3.250
</td>
<td>
3.804
</td>
<td>
0.554
</td>
<td>
56
</td>
<td>
0.278
</td>
</tr>
<tr>
<th>
15663
</th>
<td>
Devils on the Doorstep (Guizi lai le) (2000)
</td>
<td>
2.926
</td>
<td>
3.479
</td>
<td>
0.553
</td>
<td>
61
</td>
<td>
-0.046
</td>
</tr>
</tbody>
</table>
<p>We see similar results when we look at the most overrated:</p>
<table class="dataframe table table-sm table-striped small">
<thead>    <tr style="text-align: left;">
      <th></th>
      <th>Title</th>
      <th>Average Rating</th>
      <th>Adjusted Rating</th>
      <th>Delta</th>
      <th>Number of Ratings</th>
      <th>Movie Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7696</th>
      <td>Boys Diving, Honolulu (1901)</td>
      <td>5.0</td>
      <td>3.849</td>
      <td>-1.151</td>
      <td>1</td>
      <td>0.324</td>
    </tr>
    <tr>
      <th>7698</th>
      <td>Ella Lola, a la Trilby (1898)</td>
      <td>5.0</td>
      <td>3.849</td>
      <td>-1.151</td>
      <td>1</td>
      <td>0.324</td>
    </tr>
    <tr>
      <th>7697</th>
      <td>Barchester Chronicles, The (1982)</td>
      <td>5.0</td>
      <td>3.849</td>
      <td>-1.151</td>
      <td>1</td>
      <td>0.324</td>
    </tr>
    <tr>
      <th>7691</th>
      <td>Keeping the Promise (Sign of the Beaver, The) (1997)</td>
      <td>5.0</td>
      <td>3.849</td>
      <td>-1.151</td>
      <td>1</td>
      <td>0.324</td>
    </tr>
    <tr>
      <th>7695</th>
      <td>Boy Meets Boy (2008)</td>
      <td>5.0</td>
      <td>3.849</td>
      <td>-1.151</td>
      <td>1</td>
      <td>0.324</td>
    </tr>
    <tr>
      <th>7692</th>
      <td>Oranges (2004)</td>
      <td>5.0</td>
      <td>3.849</td>
      <td>-1.151</td>
      <td>1</td>
      <td>0.324</td>
    </tr>
    <tr>
      <th>7693</th>
      <td>Best of Ernie and Bert, The (1988)</td>
      <td>5.0</td>
      <td>3.849</td>
      <td>-1.151</td>
      <td>1</td>
      <td>0.324</td>
    </tr>
    <tr>
      <th>7694</th>
      <td>Prom Queen: The Marc Hall Story (2004)</td>
      <td>5.0</td>
      <td>3.849</td>
      <td>-1.151</td>
      <td>1</td>
      <td>0.324</td>
    </tr>
    <tr>
      <th>7699</th>
      <td>Junior Prom (1946)</td>
      <td>5.0</td>
      <td>3.849</td>
      <td>-1.151</td>
      <td>1</td>
      <td>0.324</td>
    </tr>
    <tr>
      <th>7700</th>
      <td>Turkish Dance, Ella Lola (1898)</td>
      <td>5.0</td>
      <td>3.849</td>
      <td>-1.151</td>
      <td>1</td>
      <td>0.324</td>
    </tr>
</table>
<p>Looking at the most overrated movies with at least 50 reviews, we notice something interesting:</p>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Title
</th>
<th>
Average Rating
</th>
<th>
Adjusted Rating
</th>
<th>
Delta
</th>
<th>
Number of Ratings
</th>
<th>
Movie Coefficient
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
23938
</th>
<td>
Big Green, The (1995)
</td>
<td>
2.855
</td>
<td>
2.858
</td>
<td>
0.003
</td>
<td>
956
</td>
<td>
-0.668
</td>
</tr>
<tr>
<th>
16408
</th>
<td>
Stefano Quantestorie (1993)
</td>
<td>
3.439
</td>
<td>
3.441
</td>
<td>
0.002
</td>
<td>
57
</td>
<td>
-0.085
</td>
</tr>
<tr>
<th>
15076
</th>
<td>
Captives (1994)
</td>
<td>
3.508
</td>
<td>
3.507
</td>
<td>
-0.001
</td>
<td>
181
</td>
<td>
-0.018
</td>
</tr>
<tr>
<th>
25637
</th>
<td>
Gordy (1995)
</td>
<td>
2.531
</td>
<td>
2.528
</td>
<td>
-0.003
</td>
<td>
439
</td>
<td>
-0.997
</td>
</tr>
<tr>
<th>
23952
</th>
<td>
Man of the House (1995)
</td>
<td>
2.871
</td>
<td>
2.856
</td>
<td>
-0.015
</td>
<td>
1181
</td>
<td>
-0.669
</td>
</tr>
<tr>
<th>
22917
</th>
<td>
Homeward Bound II: Lost in San Francisco (1996)
</td>
<td>
3.002
</td>
<td>
2.984
</td>
<td>
-0.018
</td>
<td>
2430
</td>
<td>
-0.542
</td>
</tr>
<tr>
<th>
21642
</th>
<td>
Sunset Park (1996)
</td>
<td>
3.135
</td>
<td>
3.105
</td>
<td>
-0.031
</td>
<td>
251
</td>
<td>
-0.421
</td>
</tr>
<tr>
<th>
13566
</th>
<td>
Talking About Sex (1994)
</td>
<td>
3.608
</td>
<td>
3.578
</td>
<td>
-0.031
</td>
<td>
106
</td>
<td>
0.052
</td>
</tr>
<tr>
<th>
25276
</th>
<td>
Santa with Muscles (1996)
</td>
<td>
2.666
</td>
<td>
2.625
</td>
<td>
-0.041
</td>
<td>
148
</td>
<td>
-0.901
</td>
</tr>
<tr>
<th>
19234
</th>
<td>
Lotto Land (1995)
</td>
<td>
3.328
</td>
<td>
3.279
</td>
<td>
-0.049
</td>
<td>
58
</td>
<td>
-0.247
</td>
</tr>
</tbody>
</table>
<p>It’s interesting that there are only eight movies with at least 50 ratings and with a negative “Delta” between their average and adjusted ratings. I’m curious what’s going on here.. if it’s truly a facet of the distribution of movie ratings, or if it’s due to the analysis and regularization, or what. To evaluate on the latter, the mean of all the movies is about <span class="math inline">\(3.53\)</span>, so there’s a lot more room for a movie to be rated below average as opposed to above average. The <span class="math inline">\(L^2\)</span> regularization prevents the Movie and User Coefficients from becoming too large, so the estimated ratings will be closer to the mean, leading to larger deltas for poorly rated movies than for highly rated films. Looking at the distribution of <span class="math inline">\(\alpha\)</span>s, <span class="math inline">\(\beta\)</span>s, and the Deltas, we see this to be the case.</p>
<p><img src="Media/Movie_coef_histogram.png"> <img src="Media/User_coef_histogram.png"> <img src="Media/Delta_histogram.png"></p>
<p>While the User Coefficients (<span class="math inline">\(\alpha_i\)</span>) appear normally distributed, the Movie Coefficients (<span class="math inline">\(\beta_j\)</span>) are left-skewed, with more large negative values compared to large positive values. I expect things to be more balanced (but perhaps not generalize as well) if we don’t use regularization.</p>
<div id="0c346786-ebb6-4eb3-9df6-51bb0090ad12" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># setup and fit the model</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this cell will likely take a while to run, there &gt; 20,000 parameters to fit in this optimization</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>ohe <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>, sparse_output<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_pipeline(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    ohe,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    Ridge(alpha<span class="op">=</span><span class="fl">0.0</span>)       <span class="co"># This being 0 removes the regularization</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>model.fit(ratings[[<span class="st">'userId'</span>,<span class="st">'movieId'</span>]], ratings[<span class="st">'rating'</span>])</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> model.named_steps[<span class="st">'onehotencoder'</span>]</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> encoder.get_feature_names_out([<span class="st">'userId'</span>, <span class="st">'movieId'</span>])</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>coef <span class="op">=</span> model.named_steps[<span class="st">'ridge'</span>].coef_</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>intercept <span class="op">=</span> model.named_steps[<span class="st">'ridge'</span>].intercept_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Movies that have few total ratings still dominate the leaderboard, so we still want to filter. Here are the top underrated and overrated movies with at least 50 ratings according to this non-regularized approach. For the overrated, we still see the same phenomenon, with there being very few movies making the list.</p>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Title
</th>
<th>
Average Rating
</th>
<th>
Adjusted Rating
</th>
<th>
Delta
</th>
<th>
Number of Ratings
</th>
<th>
Movie Coefficient
</th>
</tr>

</thead>
<tbody>
<tr>
<th>
9332
</th>
<td>
As Tears Go By (Wong gok ka moon) (1988)
</td>
<td>
3.192
</td>
<td>
3.826
</td>
<td>
0.634
</td>
<td>
52
</td>
<td>
0.301
</td>
</tr>
<tr>
<th>
5466
</th>
<td>
Merchant of Four Seasons, The (Händler der vier Jahreszeiten) (1972)
</td>
<td>
3.406
</td>
<td>
4.031
</td>
<td>
0.624
</td>
<td>
64
</td>
<td>
0.505
</td>
</tr>
<tr>
<th>
15647
</th>
<td>
Pellet (Bola, El) (2000)
</td>
<td>
2.900
</td>
<td>
3.485
</td>
<td>
0.585
</td>
<td>
50
</td>
<td>
-0.041
</td>
</tr>
<tr>
<th>
2312
</th>
<td>
Autumn Afternoon, An (Sanma no aji) (1962)
</td>
<td>
3.669
</td>
<td>
4.253
</td>
<td>
0.584
</td>
<td>
71
</td>
<td>
0.728
</td>
</tr>
<tr>
<th>
11573
</th>
<td>
Separation, The (Séparation, La) (1994)
</td>
<td>
3.127
</td>
<td>
3.708
</td>
<td>
0.581
</td>
<td>
51
</td>
<td>
0.183
</td>
</tr>
<tr>
<th>
3930
</th>
<td>
I Hired a Contract Killer (1990)
</td>
<td>
3.548
</td>
<td>
4.127
</td>
<td>
0.579
</td>
<td>
52
</td>
<td>
0.602
</td>
</tr>
<tr>
<th>
7291
</th>
<td>
Dames du Bois de Boulogne, Les (Ladies of the Bois de Boulogne, The) (Ladies of the Park) (1945)
</td>
<td>
3.357
</td>
<td>
3.935
</td>
<td>
0.578
</td>
<td>
70
</td>
<td>
0.409
</td>
</tr>
<tr>
<th>
2813
</th>
<td>
Eureka (Yurîka) (2000)
</td>
<td>
3.630
</td>
<td>
4.206
</td>
<td>
0.575
</td>
<td>
96
</td>
<td>
0.680
</td>
</tr>
<tr>
<th>
13082
</th>
<td>
See the Sea (1997)
</td>
<td>
3.054
</td>
<td>
3.626
</td>
<td>
0.572
</td>
<td>
56
</td>
<td>
0.100
</td>
</tr>
<tr>
<th>
9436
</th>
<td>
Lili Marleen (1981)
</td>
<td>
3.250
</td>
<td>
3.821
</td>
<td>
0.571
</td>
<td>
56
</td>
<td>
0.296
</td>
</tr>
</tbody>
</table>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Title
</th>
<th>
Average Rating
</th>
<th>
Adjusted Rating
</th>
<th>
Delta
</th>
<th>
Number of Ratings
</th>
<th>
Movie Coefficient
</th>
</tr>

</thead>
<tbody>
<tr>
<th>
23011
</th>
<td>
Big Green, The (1995)
</td>
<td>
2.855
</td>
<td>
2.865
</td>
<td>
0.010
</td>
<td>
956
</td>
<td>
-0.661
</td>
</tr>
<tr>
<th>
16292
</th>
<td>
Stefano Quantestorie (1993)
</td>
<td>
3.439
</td>
<td>
3.445
</td>
<td>
0.006
</td>
<td>
57
</td>
<td>
-0.081
</td>
</tr>
<tr>
<th>
15071
</th>
<td>
Captives (1994)
</td>
<td>
3.508
</td>
<td>
3.513
</td>
<td>
0.004
</td>
<td>
181
</td>
<td>
-0.013
</td>
</tr>
<tr>
<th>
24806
</th>
<td>
Gordy (1995)
</td>
<td>
2.531
</td>
<td>
2.532
</td>
<td>
0.002
</td>
<td>
439
</td>
<td>
-0.993
</td>
</tr>
<tr>
<th>
23031
</th>
<td>
Man of the House (1995)
</td>
<td>
2.871
</td>
<td>
2.863
</td>
<td>
-0.009
</td>
<td>
1181
</td>
<td>
-0.663
</td>
</tr>
<tr>
<th>
21995
</th>
<td>
Homeward Bound II: Lost in San Francisco (1996)
</td>
<td>
3.002
</td>
<td>
2.989
</td>
<td>
-0.013
</td>
<td>
2430
</td>
<td>
-0.536
</td>
</tr>
<tr>
<th>
13786
</th>
<td>
Talking About Sex (1994)
</td>
<td>
3.608
</td>
<td>
3.585
</td>
<td>
-0.024
</td>
<td>
106
</td>
<td>
0.059
</td>
</tr>
<tr>
<th>
20839
</th>
<td>
Sunset Park (1996)
</td>
<td>
3.135
</td>
<td>
3.109
</td>
<td>
-0.026
</td>
<td>
251
</td>
<td>
-0.416
</td>
</tr>
<tr>
<th>
24440
</th>
<td>
Santa with Muscles (1996)
</td>
<td>
2.666
</td>
<td>
2.624
</td>
<td>
-0.041
</td>
<td>
148
</td>
<td>
-0.901
</td>
</tr>
<tr>
<th>
18757
</th>
<td>
Lotto Land (1995)
</td>
<td>
3.328
</td>
<td>
3.279
</td>
<td>
-0.048
</td>
<td>
58
</td>
<td>
-0.246
</td>
</tr>
</tbody>
</table>
<p>Finally, here’s the distribution of the Movie Coefficients (<span class="math inline">\(\beta_j\)</span>) under the non-regularized approach. We can see it’s more spread out and balanced, as expected.</p>
<p><img src="Media/Movie_coef_histogram_unreg.png"></p>
<p>We could conduct many hypothesis tests and pare the model down to solely those parameters that appear to be statistically significant, but I’ll save that analysis for another time.</p>
</section>
<section id="further-approaches-and-questions" class="level4">
<h4 class="anchored" data-anchor-id="further-approaches-and-questions">Further approaches and questions</h4>
<p>Stay tuned for future posts on other recommender systems where I’ll answer questions such as</p>
<ul>
<li>How does one select the hyperparameter <span class="math inline">\(\lambda\)</span>?</li>
<li>How can we measure the performance of the model?</li>
<li>What about personalized recommender systems?</li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>